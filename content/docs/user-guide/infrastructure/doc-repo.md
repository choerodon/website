+++
title = "文档库管理"
description = ""
weight = 1
+++

# 文档库管理

## 1. 概述

统一文档库基于SVN，主要用来创建项目文档库、管理文件夹权限、查询日志等。

## 2. 前置条件

具有管理文档库的权限，例如项目所有者。各角色所拥有权限详情如下:

- 项目所有者：创建文档库、创建文件夹、查看文档库目录、分配权限、查看操作日志等
- 项目成员：查看文档库目录、查看权限、查看文档库地址
- 组织管理员：查看文档库列表，查看权限、查看操作记录、异常处理

## 3. 创建文档库

要创建文档库，您需要进行以下步骤：

1. 点击Choerodon平台顶部“项目”导航，进入项目列表；
2. 点击项目名称进入项目，点击菜单“基础>文档库管理”，进入文档库管理页面；

    ![image](/docs/user-guide/infrastructure/image/doc-repo/doc-repo-create01.png)

3. 点击"创建文档库"，弹出侧弹窗；

4. 选择关联授权服务器，即可以和其他项目共用一台服务器：

    1）若没有授权服务器，会有提示信息“该项目没有授权服务器，请向组织管理员申请服务器授权”
    
    ![image](/docs/user-guide/infrastructure/image/doc-repo/create02.png)

    2) 若已授权，会带出授权服务器的IP地址、域名信息等：
    - 服务器编码：文档库服务编码
    - 服务器名称：文档库服务名称
    - 服务器IP地址：文档库服务IP
    - 域名地址：SVN域名
    - 已有文档库：原有文档库是否存放在当前服务器上，若有则导入旧文档库，若没有则创建新文档库
    - 原文档库名称：原文档库名称

    ![image](/docs/user-guide/infrastructure/image/doc-repo/create03.png)
    
    3）点击创建，即可创建文档库

5. 选择关联新服务器，需要维护服务器信息，具体如下：

    1）维护基本信息
    * 服务器编码：编码唯一
    * 服务器名称：描述服务器信息
    * 基本信息
        * 服务器类型：支持Centos、Ubuntu。暂不支持windows
        * 服务器IP地址：服务器IP，如192.168.1.**
        * 用户名：服务器登录用户名，如root
        * 端口号：连接服务器时开放的端口号，默认22
        * 授权模式：密码认证、私钥认证。、
        
        `若选择密码认证，则“密码/口令”框输入服务器密码，必输；若选择私钥认证，则“密码/口令”框输入口令值（非必输），必须上传私钥文件。`
       
        ![image](/docs/user-guide/infrastructure/image/doc-repo/create04.png)

    * 用户管理方式
        * Http配置文件：用户保存在Http配置文件，格式admin=$apr1$.......(密码使用MD5加密)
            * HTTP用户配置文件路径：保存位置，默认地址“/svn/http-passwd”
            * HTTP项目配置文件路径：/etc/httpd/conf.d/subversion.conf 
            * Httpd服务监听端口号：默认80
        * Mysql数据库：用户保存在Mysql数据库中
            * HTTP项目配置文件路径：/etc/httpd/conf.d/subversion.conf 
            * 数据库IP：如192.168.1.1
            * 数据库用户名
            * 数据库密码
            * Httpd服务监听端口号：默认80
    * 其他配置
        * 域名地址：服务器域名。
        * 版本库根路径：存放项目文档的父目录，默认“/svn/repos/”
        * 授权超时：连接服务器超时时间，默认200000s
    
    2）点击"创建"即可。

    ![image](/docs/user-guide/infrastructure/image/doc-repo/create05.png)
    
    ![image](/docs/user-guide/infrastructure/image/doc-repo/create06.png)

## 4. 管理文件夹

1. 点击Choerodon平台顶部“项目”导航，进入项目列表；
2. 点击项目名称进入项目，点击菜单“基础>文档库管理”，进入文档库管理页面；
3. 点击“创建一级目录”
    - 输入“目录名称”
    - 点击保存即可创建文件夹并且提交到SVN库中
4. 创建"子目录"
    - 鼠标移动到文件夹目录上
    - 点击“+”
    - 输入目录名称即可创建子目录
5. 重命名目录
    - 鼠标移动到文件夹目录上
    - 点击”三个点“
    - 点击”重命名“
    - 输入新目录名称
6. 删除目录
    - 鼠标移动到文件夹目录上
    - 点击”三个点“
    - 点击”删除“即可。注意：删除功能会把该目录下的所有内容删除

    ![image](/docs/user-guide/infrastructure/image/doc-repo/dir01.png)

## 5. 权限管理

1. 点击Choerodon平台顶部“项目”导航，进入项目列表；
2. 点击项目名称进入项目，点击菜单“基础>文档库管理”，进入文档库管理页面；
3. 选中文件夹目录，若分配根目录权限，可不选中
4. 点击"添加成员按钮"，弹出侧弹窗
    * 项目下所有人员：对项目下所有人员分配当前目录权限
        - 选择权限层级：读写、只读
        - 点击"添加"即可
    * 项目下特定人员：对项目下部分人员分配当前目录权限
        - 成员：从下拉列表选择团队成员
        - 选择权限层级
        - 点击"添加"即可
        
    
    ![image](/docs/user-guide/infrastructure/image/doc-repo/auth01.png)
5. 点击"权限分配"TAB，可看到权限基本信息：
    - 登录名：登录账号
    - 用户名：用户姓名
    - 资源路径：有权限访问的文件夹目录。如"/test"只能访问test目录
    - 权限层级：读写、只读
6. 删除权限：
    
    - 点击列表中右侧“垃圾筐”按钮，即可删除对应权限
7. 更新权限：
    - 点击表格中的权限列
    - 选择权限层级
    - 点击保存按钮即可更新权限

    ![image](/docs/user-guide/infrastructure/image/doc-repo/auth02.png)

8. 导出权限：
    - 点击头部栏"导出权限"按钮，即可
    
    ![image](/docs/user-guide/infrastructure/image/doc-repo/auth03.png)

> 1.文档库创建者拥有根路径读写权限，不可删除不可更新；
>
> 2.当分配权限或者更新权限时，若父目录已经存在读写权限，则子目录权限不再分配。
>
> 如：用户A已经拥有“/一级目录”的读写权限：
>
> a.若管理员再次分配“/一级目录/二级目录”的“读写”权限给用户A，后台检测到用户已经拥有二级目录的读写权限，则会自动跳过此次分配。
>
> b.若分配“/一级目录/二级目录”的“只读”权限，则会新增一条权限信息，表示“用户A除了二级目录外，一级目录下的其他文件都可以读写”
> 

## 6. 复制仓库地址

点击"复制仓库地址"按钮，如：http://192.168.17.117:17142/infra-project
可以通过TortoiseSVN访问，也可以在浏览器打开。密码可以在"个人信息>个人设置>SVN设置"中查看。

若地址以ldap结尾，则使用公司的个人门户账号密码登录

![image](/docs/user-guide/infrastructure/image/doc-repo/copy01.png)

## 7. 操作日志
1. 点击Choerodon平台顶部“项目”导航，进入项目列表
2. 点击项目名称进入项目，点击菜单“基础>文档库管理”，进入文档库管理页面
3. 点击"操作日志"Tab页，可以查看操作日志记录

## 8. 服务器管理
1. 项目层-更新服务器：
    - 点击Choerodon平台顶部“项目”导航，进入项目列表
    - 点击项目名称进入项目，点击菜单“基础>文档库管理”，进入文档库管理页面
    - 点击"服务器配置"Tab页：可以查看当前项目所在服务器信息
    - 点击“修改服务器”按钮，即可更新服务器信息

2. 组织层-创建服务器：
    - 点击Choerodon平台顶部“管理中心”导航，进入组织层
    - 点击菜单“基础>文档库管理”，进入文档库管理页面
    - 点击"服务器配置"TAB页，可以看到服务器详细信息
    - 点击"创建服务器"按钮，输入服务器信息，点击创建即可
    
    ![image](/docs/user-guide/infrastructure/image/doc-repo/server01.png)

3. 组织层-编辑服务器：
    - 点击Choerodon平台顶部“管理中心”导航，进入组织层
    - 点击菜单“基础>文档库管理”，进入文档库管理页面
    - 点击"服务器配置"TAB页，可以看到服务器详细信息
    - 点击服务器名称右边的"三个点"，点击"编辑"按钮

4. 组织层-删除服务器：
    - 点击Choerodon平台顶部“管理中心”导航，进入组织层
    - 点击菜单“基础>文档库管理”，进入文档库管理页面
    - 点击"服务器配置"TAB页，可以看到服务器详细信息
    - 点击服务器名称右边的"三个点"，点击"删除"按钮
    `只有未使用的服务器才可以删除`
    
5. 组织层-服务器授权：
    - 点击Choerodon平台顶部“管理中心”导航，进入组织层
    - 点击菜单“基础>文档库管理”，进入文档库管理页面
    - 点击"服务器配置"TAB页，可以看到服务器详细信息
    - 点击服务器名称右边的"三个点"，点击"授权"按钮
    - 选择项目，点击"授权"即可
    `一个项目只能被授权一次`

6. 组织层-服务器取消授权：
    - 点击Choerodon平台顶部“管理中心”导航，进入组织层
    - 点击菜单“基础>文档库管理”，进入文档库管理页面
    - 点击"服务器配置"TAB页，可以看到服务器详细信息
    - 点击服务器名称左边的"展开箭头"，可看到已授权的项目详情
    - 选择项目，点击"取消授权"即可
    `一个项目只能被授权一次`
    
## 9. 健康检查

服务健康扫描：显示HTTPD、SVN服务的健康情况。帮助运维人员快速解决问题。

![image](/docs/user-guide/infrastructure/image/doc-repo/health01.png)

## 10. 异常处理

1. 点击Choerodon平台顶部“管理中心”导航，进入组织层
2. 点击菜单“基础>文档库管理”，进入文档库管理页面
3. 点击"异常处理"Tab页
4. 点击表格中“异常节点”列，弹出“解决策略”侧边页
5. 选择天数，可以查看近30天的异常情况

![image](/docs/user-guide/infrastructure/image/doc-repo/health02.png)